import{j as t,r as C,d as F,e as A,f as U,g as D,h as T,i as W,u as Q,o as S,b as E,O as G}from"./index-EQ7WCn_a.js";import{B as o}from"./Button-NgNVC6NY.js";import{a as k,u as V}from"./app.hooks-DxXljtc5.js";import{b as H}from"./byteArrayToFile-uoPBimIa.js";import"./className-CUjXWMz9.js";const J="_bottom-bar_109re_1",K="_bottom-filler_109re_19",B={bottomBar:J,bottomFiller:K},X="_overlay_hz7rp_1",Y="_popup_hz7rp_14",Z="_header_hz7rp_23",tt="_closeButton_hz7rp_34",et="_content_hz7rp_45",b={overlay:X,popup:Y,header:Z,closeButton:tt,content:et},at=a=>{const{isOpen:e,onClose:s,onSelectPaymentMethod:r,isLoading:c}=a;return e?t.jsx("div",{className:b.overlay,children:t.jsxs("div",{className:b.popup,children:[t.jsxs("div",{className:b.header,children:[t.jsx("h2",{children:"Selectează metoda de plată"}),t.jsx("button",{className:b.closeButton,onClick:s,children:"×"})]}),t.jsxs("div",{className:b.content,children:[t.jsx(o,{text:"Cash",color:"brand",tall:!0,onClick:()=>r("cash"),loading:c,disabled:c}),t.jsx(o,{text:"Card",color:"brand",tall:!0,onClick:()=>r("card"),loading:c,disabled:c})]})]})}):null},ot=({})=>{const{products:a,status:e,selectedProductsForPayment:s,tipAmount:r,isLoaded:c}=k(n=>n.order),[i,h]=C.useState(!1),{locationSlug:l,tableNumber:u}=F({strict:!1}),m=parseInt(u,10),{data:d,refetch:O}=A({locationSlug:l,table:m}),{data:x}=U({locationSlug:l,table:m}),[L,{isLoading:y}]=D(),[w,{isLoading:f}]=T(),[z,{isLoading:$}]=W(),I=s.reduce((n,p)=>n+p.price*p.quantity,0),v=V(),g=Q(),_=()=>{const n={orderTime:new Date,products:st(a)};L({order:n,locationSlug:l,tableNumber:m}),setTimeout(()=>{g({to:"/$locationSlug/$tableNumber",params:{locationSlug:l,tableNumber:u}}),O()},2e3)},M=()=>{v(S.setStatus("checkout")),g({to:"/$locationSlug/$tableNumber/order",params:{locationSlug:l,tableNumber:u}})},N=()=>{v(S.setStatus("payment")),g({to:"/$locationSlug/$tableNumber/payment",params:{locationSlug:l,tableNumber:u}})},P=async()=>{try{await w({locationSlug:l,tableNumber:m}).unwrap()}catch(n){console.error("Failed to call waiter:",n)}},R=()=>{h(!0)},q=async n=>{try{await z({bill:{items:s,paymentMethod:n,tips:r},locationSlug:l,tableNumber:m}).unwrap(),h(!1),g({to:"/$locationSlug/$tableNumber",params:{locationSlug:l,tableNumber:u}})}catch(p){console.error("Failed to create bill:",p),h(!1)}};return t.jsx(t.Fragment,{children:c&&t.jsxs(t.Fragment,{children:[t.jsx("div",{className:B.bottomFiller}),t.jsxs("div",{className:B.bottomBar,children:[t.jsx(at,{isOpen:i,onClose:()=>h(!1),onSelectPaymentMethod:q,isLoading:$}),e==="empty"?t.jsx(o,{text:x?"Ospătar chemat":"Cheamă ospătar",wider:!0,tall:!0,color:"brand",onClick:P,loading:f,disabled:x}):e==="products"?t.jsxs(t.Fragment,{children:[t.jsx(o,{text:x?"Ospătar chemat":"Cheamă ospătar",tall:!0,color:"brand",onClick:P,loading:f,disabled:x}),t.jsx(o,{onClick:M,text:"Vezi comanda",tall:!0,color:"brand"})]}):e==="payment"?t.jsxs(t.Fragment,{children:[t.jsx(o,{onClick:N,text:"Plata online",tall:!0,color:"brand",disabled:!0}),t.jsx(o,{onClick:R,text:"Cere nota",tall:!0,color:"brand",disabled:I===0})]}):d!=null&&d.length&&a.length>0?t.jsx(o,{onClick:_,text:"Adauga la comanda",wider:!0,tall:!0,color:"brand",loading:y,disabled:e==="placed"}):d!=null&&d.length&&a.length===0?t.jsx(o,{text:"Plătește comanda",wider:!0,tall:!0,color:"brand",onClick:N}):t.jsx(o,{onClick:_,text:"Plasează comanda",wider:!0,tall:!0,color:"brand",loading:y,disabled:e==="placed"})]})]})})},st=a=>a.map(s=>({id:s.productId,quantity:s.quantity,preferences:""})),rt="_navbar_1v7qz_1",lt="_nav-filler_1v7qz_25",j={navbar:rt,navFiller:lt},nt=({})=>{const{logoBuffer:a,logoMime:e,name:s}=k(i=>i.location),[r,c]=C.useState("");return C.useEffect(()=>{const i=a&&e?H(a,e):void 0;return console.log("file",e),c(i?URL.createObjectURL(i):void 0),()=>{r&&URL.revokeObjectURL(r)}},[a,e]),t.jsxs(t.Fragment,{children:[t.jsx("nav",{className:j.navbar,children:r?t.jsx("img",{className:j.logo,src:r,alt:"logo"}):t.jsx("h1",{children:s})}),";",t.jsx("div",{className:j.navFiller})]})},pt=function(){const{locationSlug:e}=F({strict:!1});return E(e),t.jsxs(t.Fragment,{children:[t.jsx(nt,{}),t.jsx(G,{}),t.jsx(ot,{})]})};export{pt as component};
