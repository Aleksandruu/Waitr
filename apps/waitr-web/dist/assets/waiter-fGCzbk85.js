import{j as e,w as q,k as E,l as I,m as R,n as D,p as G,q as M,r as x,s as W,t as U,v as J,x as K,y as V}from"./index-EQ7WCn_a.js";import{c as A}from"./className-CUjXWMz9.js";import{u as H,a as S}from"./app.hooks-DxXljtc5.js";import{B as f}from"./Button-NgNVC6NY.js";import{Q as X}from"./QuantityButton-C9zv40x2.js";const Y="_tables-list_1o9co_1",Z="_table_1o9co_1",ee="_ready_1o9co_32",te="_preparing_1o9co_35",se="_delivered_1o9co_38",ae="_payed_1o9co_41",oe="_selectedTable_1o9co_44",ne="_filler_1o9co_50",v={tablesList:Y,table:Z,ready:ee,preparing:te,delivered:se,payed:ae,selectedTable:oe,filler:ne},re=t=>{const r=H(),{selectedTable:d,tablesStatus:a}=S(c=>c.waiter);return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:v.tablesList,children:a&&a.map(c=>{const p=c.status==="ready"||c.status==="billed"?v.ready:c.status==="preparing"?v.preparing:c.status==="delivered"?v.delivered:v.payed;return e.jsx("div",{className:A(v.table,p,d===c.tableNumber?v.selectedTable:""),onClick:()=>{r(q.setSelectedTable(c.tableNumber)),r(q.setSelectedTableProductsToBePaid([]))},children:c.tableNumber},c.tableNumber)})}),e.jsx("div",{className:v.filler})]})},ce="_container_1rojh_1",ie="_billsSection_1rojh_10",Q={container:ce,billsSection:ie},le="_product_1a633_1",de="_ready_1a633_27",ue="_preparing_1a633_31",pe="_delivered_1a633_35",_e="_payed_1a633_39",O={product:le,ready:de,preparing:ue,delivered:pe,payed:_e},me=({orderItem:t})=>{const{selectedTable:r,selectedTableProductsToBePaid:d}=S(j=>j.waiter),[a,{isLoading:c}]=E(),p=H(),[_]=I(),s=d.find(j=>j.id===t.id),u=s?s.quantity:0,h=()=>{p(q.addProductToSelectedTableProductsToBePaid(t))},g=()=>{p(q.increaseQuantityForSelectedTableProduct({productId:t.id}))},w=()=>{p(q.decreaseQuantityForSelectedTableProduct({productId:t.id}))},P=new Date(t.orderTime).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),N=t.status==="ready"||t.status==="billed"?O.ready:["cook","barista","barman"].includes(t.status)?O.preparing:t.status==="delivered"?O.delivered:O.payed;return e.jsxs("div",{className:A(O.product,N),children:[e.jsxs("div",{children:[e.jsxs("h2",{children:[t.name," x",t.quantity]}),e.jsxs("p",{children:["Comandat la ",P]}),["cook","barista","barman"].includes(t.status)&&e.jsx("p",{children:"Se prepara..."}),t.status=="delivered"&&e.jsx("p",{children:"Produs livrat"}),t.status=="billed"&&e.jsx("p",{children:"Pe nota de plata"}),t.status=="payed"&&e.jsx("p",{children:"Produs achitat"})]}),t.status==="payed"?e.jsx("div",{}):t.status==="delivered"?e.jsx(X,{text:"Incaseaza",quantity:u,color:"yellow",tall:!0,onClick:h,onIncrement:g,onDecrement:w,disabled:u===t.quantity}):["cook","barista","barman"].includes(t.status)?e.jsx(f,{text:"Livreaza",color:"orange",disabled:!0,tall:!0}):t.status==="billed"?"":e.jsx(f,{text:"Livreaza",color:"red",tall:!0,onClick:()=>a({orderProductId:t.id,tableNumber:r}).then(()=>_(r)),loading:c})]})},he="_bill_tvomh_1",xe="_billItems_tvomh_27",ye="_billItem_tvomh_27",je="_tips_tvomh_41",be="_total_tvomh_46",ve="_billed_tvomh_51",T={bill:he,billItems:xe,billItem:ye,tips:je,total:be,billed:ve},ge=({bill:t})=>{const{selectedTable:r}=S(u=>u.waiter),[d,{isLoading:a}]=R(),[c]=I(),p=new Date(t.createdAt).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),_=t.totalAmount,s=t.tips>0?t.tips:0;return e.jsxs("div",{className:A(T.bill,T.billed),children:[e.jsxs("div",{children:[e.jsx("h2",{children:"Nota de plata"}),e.jsxs("p",{children:["Creata la ",p]}),e.jsx("div",{className:T.billItems,children:t.items.map((u,h)=>e.jsxs("div",{className:T.billItem,children:[e.jsxs("span",{children:[u.name," x",u.quantity]}),e.jsxs("span",{children:[u.price*u.quantity," RON"]})]},h))}),s>0&&e.jsxs("p",{className:T.tips,children:["Tips: ",s," RON"]}),e.jsxs("p",{className:T.total,children:["Total: ",_," RON"]})]}),e.jsx(f,{text:"Incaseaza",color:"red",tall:!0,onClick:()=>d(t.id).then(()=>c(r)),loading:a})]})},fe="http://localhost:8080",L=D(fe,{withCredentials:!0,transports:["websocket"]}),Pe=(t,r)=>{const d=`waiter-${t}`;L.emit("join-location",d),L.off("order-ping"),L.on("order-ping",a=>{r(a.table)})},Ne="_bottom-bar_3vf0m_1",Ce="_products-to-be-paid_3vf0m_22",Te="_product-item_3vf0m_31",Be="_total_3vf0m_32",qe="_price_3vf0m_41",Se="_bottom-filler_3vf0m_53",B={bottomBar:Ne,productsToBePaid:Ce,productItem:Te,total:Be,price:qe,bottomFiller:Se},we="_popupOverlay_jvep7_1",ke="_popupContent_jvep7_14",Oe="_popupHeader_jvep7_25",Ie="_closeButton_jvep7_37",Fe="_categoriesContainer_jvep7_48",Le="_categoryAccordion_jvep7_54",Ae="_categoryHeader_jvep7_60",He="_expandIcon_jvep7_73",$e="_productsContainer_jvep7_77",Qe="_productItem_jvep7_81",ze="_productInfo_jvep7_92",Ee="_productPrice_jvep7_100",Re="_quantityControls_jvep7_106",De="_quantityButton_jvep7_112",Ge="_quantity_jvep7_106",Me="_popupFooter_jvep7_135",We="_orderSummary_jvep7_145",l={popupOverlay:we,popupContent:ke,popupHeader:Oe,closeButton:Ie,categoriesContainer:Fe,categoryAccordion:Le,categoryHeader:Ae,expandIcon:He,productsContainer:$e,productItem:Qe,productInfo:ze,productPrice:Ee,quantityControls:Re,quantityButton:De,quantity:Ge,popupFooter:Me,orderSummary:We},Ue=({isOpen:t,onClose:r,tableNumber:d})=>{const{data:a,isLoading:c}=G(),[p,{isLoading:_}]=M(),[s,u]=x.useState(null),[h,g]=x.useState([]);x.useEffect(()=>{t&&g([])},[t]),x.useEffect(()=>{a&&a.length>0&&!s&&u(a[0].categoryId)},[a,s]);const w=n=>{u(s===n?null:n)},P=(n,i)=>{g(b=>{const C=b.findIndex(y=>y.id===n);if(C>=0){const y=[...b],o=y[C].quantity+i;return o<=0?y.filter(m=>m.id!==n):(y[C]={...y[C],quantity:o},y)}else if(i>0)return[...b,{id:n,quantity:i}];return b})},N=n=>{const i=h.find(b=>b.id===n);return i?i.quantity:0},j=async()=>{if(!(h.length===0||!d))try{await p({table:d,products:h}).unwrap(),r()}catch(n){console.error("Failed to create order:",n)}},F=h.reduce((n,i)=>n+i.quantity,0);return t?e.jsx("div",{className:l.popupOverlay,children:e.jsxs("div",{className:l.popupContent,children:[e.jsxs("div",{className:l.popupHeader,children:[e.jsxs("h2",{children:["Adaugă produse la masa ",d]}),e.jsx("button",{className:l.closeButton,onClick:r,children:"×"})]}),e.jsx("div",{className:l.categoriesContainer,children:c?e.jsx("p",{children:"Se încarcă produsele..."}):a&&a.length>0?a.map(n=>e.jsxs("div",{className:l.categoryAccordion,children:[e.jsxs("div",{className:l.categoryHeader,onClick:()=>w(n.categoryId),children:[e.jsx("h3",{children:n.categoryName}),e.jsx("span",{className:l.expandIcon,children:s===n.categoryId?"▼":"►"})]}),s===n.categoryId&&e.jsx("div",{className:l.productsContainer,children:n.products.map(i=>e.jsxs("div",{className:l.productItem,children:[e.jsxs("div",{className:l.productInfo,children:[e.jsx("h4",{children:i.name}),e.jsxs("p",{className:l.productPrice,children:[i.price.toFixed(2)," lei"]})]}),e.jsxs("div",{className:l.quantityControls,children:[e.jsx("button",{className:l.quantityButton,onClick:()=>P(i.id,-1),disabled:N(i.id)===0,children:"-"}),e.jsx("span",{className:l.quantity,children:N(i.id)}),e.jsx("button",{className:l.quantityButton,onClick:()=>P(i.id,1),children:"+"})]})]},i.id))})]},n.categoryId)):e.jsx("p",{children:"Nu există produse disponibile."})}),e.jsxs("div",{className:l.popupFooter,children:[e.jsx("div",{className:l.orderSummary,children:e.jsxs("span",{children:["Produse selectate: ",F]})}),e.jsx(f,{text:"Adaugă produsele la comandă",color:"brand",wider:!0,tall:!0,onClick:j,loading:_,disabled:h.length===0})]})]})}):null},Je=({})=>{var y;const{selectedTableProductsToBePaid:t,selectedTable:r,orders:d}=S(o=>o.waiter),a=x.useRef(null),[c,p]=x.useState(100),[_,s]=x.useState([]),[u,{isLoading:h}]=W(),[g]=I(),[w]=U(),P=H(),[N,j]=x.useState(!1),F=!!((y=d.find(o=>o.table===r))!=null&&y.waiterCalledAt),n=()=>{u(t.map(o=>({orderProductId:o.id,quantity:o.quantity}))).then(()=>{g(r),P(q.setSelectedTableProductsToBePaid([]))})},i=()=>{j(!0)},b=()=>{j(!1),g(r)};x.useEffect(()=>{const o=t.reduce((m,k)=>{const $=m.find(z=>z.productId===k.productId);return $?$.quantity+=k.quantity:m.push({...k}),m},[]);s(o)},[t]);const C=_.reduce((o,m)=>o+m.price*m.quantity,0);return x.useEffect(()=>{const o=()=>{if(a.current){const k=a.current.offsetHeight;p(k)}};o();const m=new ResizeObserver(o);return a.current&&m.observe(a.current),()=>{m.disconnect()}},[_]),e.jsxs(e.Fragment,{children:[e.jsx("div",{className:B.bottomFiller,style:{height:`${c}px`}}),e.jsx("div",{className:B.bottomBar,ref:a,children:_.length!==0?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:B.productsToBePaid,children:[_.map((o,m)=>e.jsxs("p",{className:B.productItem,children:[e.jsxs("span",{children:[o.name," x",o.quantity]})," ",e.jsxs("span",{className:B.price,children:[(o.price*o.quantity).toFixed(2)," lei"]})]},o.productId+m)),e.jsxs("p",{className:B.total,children:[e.jsx("span",{children:"Total:"})," ",e.jsxs("span",{children:[C.toFixed(2)," lei"]})]})]}),e.jsx(f,{text:"Creaza nota",wider:!0,tall:!0,color:"brand",onClick:n,loading:h})]}):F?e.jsx(f,{text:"Mergi la masa",wider:!0,tall:!0,color:"red",onClick:()=>w(r).unwrap()}):e.jsx(f,{text:"Adauga produse",wider:!0,tall:!0,color:"brand",onClick:i})}),e.jsx(Ue,{isOpen:N,onClose:b,tableNumber:r})]})},Ke=({})=>{const{selectedTable:t,orders:r}=S(s=>s.waiter),{id:d}=S(s=>s.location);J();const[a]=I(),[c]=K(),{data:p}=V(t,{skip:!t}),_=r.find(s=>s.table===t);return x.useEffect(()=>{d&&Pe(d,s=>{a(s),c(s)})},[d,a]),e.jsxs("div",{className:Q.container,children:[e.jsx(re,{}),p&&p.length>0&&e.jsx("div",{className:Q.billsSection,children:p.map(s=>e.jsx(ge,{bill:s},s.id))}),_&&_.products.length>0?_.products.map((s,u)=>e.jsx(me,{orderItem:s},u)):e.jsx("p",{children:"Nu exista comenzi pentru acest masa"}),e.jsx(Je,{})]})},tt=Ke;export{tt as component};
