import{j as t,r as g,d as P,e as z,f as A,g as D,h as Q,i as E,b as G,u as V,o as F,k as H,O as J}from"./index-DzrIMVFX.js";import{B as l}from"./Button-DkkFWPV7.js";import{u as k}from"./app.hooks-DD5JABVg.js";import{b as K}from"./byteArrayToFile-uoPBimIa.js";import"./className-CUjXWMz9.js";const X="_bottom-bar_109re_1",Y="_bottom-filler_109re_19",S={bottomBar:X,bottomFiller:Y},Z="_overlay_1aaw8_1",tt="_popup_1aaw8_14",et="_header_1aaw8_23",at="_closeButton_1aaw8_34",ot="_content_1aaw8_45",b={overlay:Z,popup:tt,header:et,closeButton:at,content:ot},st=({isOpen:a,onClose:e,onSelectPaymentMethod:s,isLoading:o})=>a?t.jsx("div",{className:b.overlay,children:t.jsxs("div",{className:b.popup,children:[t.jsxs("div",{className:b.header,children:[t.jsx("h2",{children:"Selectează metoda de plată"}),t.jsx("button",{className:b.closeButton,onClick:e,children:"×"})]}),t.jsxs("div",{className:b.content,children:[t.jsx(l,{text:"Cash",color:"brand",tall:!0,wider:!0,onClick:()=>s("cash"),loading:o,disabled:o}),t.jsx(l,{text:"Card",color:"brand",tall:!0,wider:!0,onClick:()=>s("card"),loading:o,disabled:o})]})]})}):null,lt=({})=>{const{products:a,status:e,selectedProductsForPayment:s,tipAmount:o,isLoaded:j}=k(n=>n.order),[i,f]=g.useState(!1),[O,p]=g.useState(!1),{locationSlug:r,tableNumber:d}=P({strict:!1}),u=parseInt(d,10),{data:c,refetch:$}=z({locationSlug:r,table:u}),{data:x}=A({locationSlug:r,table:u}),[L,{isLoading:v}]=D(),[I,{isLoading:y}]=Q(),[R,{isLoading:W}]=E(),q=s.reduce((n,m)=>n+m.price*m.quantity,0),_=G(),h=V(),N=()=>{const n={orderTime:new Date,products:rt(a)};L({order:n,locationSlug:r,tableNumber:u}),setTimeout(()=>{h({to:"/$locationSlug/$tableNumber",params:{locationSlug:r,tableNumber:d}}),$()},2e3)},M=()=>{_(F.setStatus("checkout")),h({to:"/$locationSlug/$tableNumber/order",params:{locationSlug:r,tableNumber:d}})},w=()=>{_(F.setStatus("payment")),h({to:"/$locationSlug/$tableNumber/payment",params:{locationSlug:r,tableNumber:d}})},B=async()=>{try{await I({locationSlug:r,tableNumber:u}).unwrap(),f(!0),setTimeout(()=>{f(!1)},1e4)}catch(n){console.error("Failed to call waiter:",n)}},T=()=>{p(!0)},U=async n=>{try{await R({bill:{items:s,paymentMethod:n,tips:o},locationSlug:r,tableNumber:u}).unwrap(),p(!1),h({to:"/$locationSlug/$tableNumber",params:{locationSlug:r,tableNumber:d}})}catch(m){console.error("Failed to create bill:",m),p(!1)}};return t.jsx(t.Fragment,{children:j&&t.jsxs(t.Fragment,{children:[t.jsx("div",{className:S.bottomFiller}),t.jsxs("div",{className:S.bottomBar,children:[t.jsx(st,{isOpen:O,onClose:()=>p(!1),onSelectPaymentMethod:U,isLoading:W}),e==="empty"?t.jsx(l,{text:x?"Ospătar chemat":"Cheamă ospătar",wider:!0,tall:!0,color:"brand",onClick:B,loading:y,disabled:x}):e==="products"?t.jsxs(t.Fragment,{children:[t.jsx(l,{text:x?"Ospătar chemat":"Cheamă ospătar",tall:!0,color:"brand",onClick:B,loading:y,disabled:x}),t.jsx(l,{onClick:M,text:"Vezi comanda",tall:!0,color:"brand"})]}):e==="payment"?t.jsxs(t.Fragment,{children:[t.jsx(l,{onClick:w,text:"Plata online",tall:!0,color:"brand",disabled:!0}),t.jsx(l,{onClick:T,text:"Cere nota",tall:!0,color:"brand",disabled:q===0})]}):c!=null&&c.length&&a.length>0?t.jsx(l,{onClick:N,text:"Adauga la comanda",wider:!0,tall:!0,color:"brand",loading:v,disabled:e==="placed"}):c!=null&&c.length&&a.length===0?t.jsx(l,{text:"Plătește comanda",wider:!0,tall:!0,color:"brand",onClick:w}):t.jsx(l,{onClick:N,text:"Plasează comanda",wider:!0,tall:!0,color:"brand",loading:v,disabled:e==="placed"})]})]})})},rt=a=>a.map(s=>({id:s.productId,quantity:s.quantity,preferences:""})),nt="_navbar_1v7qz_1",ct="_nav-filler_1v7qz_25",C={navbar:nt,navFiller:ct},it=({})=>{const{logoBuffer:a,logoMime:e,name:s}=k(i=>i.location),[o,j]=g.useState("");return g.useEffect(()=>{const i=a&&e?K(a,e):void 0;return console.log("file",e),j(i?URL.createObjectURL(i):void 0),()=>{o&&URL.revokeObjectURL(o)}},[a,e]),t.jsxs(t.Fragment,{children:[t.jsx("nav",{className:C.navbar,children:o?t.jsx("img",{className:C.logo,src:o,alt:"logo"}):t.jsx("h1",{children:s})}),";",t.jsx("div",{className:C.navFiller})]})},xt=function(){const{locationSlug:e}=P({strict:!1});return H(e),t.jsxs(t.Fragment,{children:[t.jsx(it,{}),t.jsx(J,{}),t.jsx(lt,{})]})};export{xt as component};
