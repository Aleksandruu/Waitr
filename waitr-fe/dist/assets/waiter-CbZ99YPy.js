import{b as B,h as P,j as e,w as p,i as F,k as N,l as L,r as u,m as $,n as z}from"./index-CCuYgNzZ.js";import{c as w}from"./className-CUjXWMz9.js";import{B as x}from"./Button-C4_vQ40n.js";import{u as k}from"./app.hooks-CYivS1Te.js";import{Q as C}from"./QuantityButton-tTLASXtd.js";const O="_tables-list_1o9co_1",D="_table_1o9co_1",Q="_ready_1o9co_32",E="_preparing_1o9co_35",H="_delivered_1o9co_38",R="_payed_1o9co_41",A="_selectedTable_1o9co_44",W="_filler_1o9co_50",d={tablesList:O,table:D,ready:Q,preparing:E,delivered:H,payed:R,selectedTable:A,filler:W},G=t=>{const i=B(),{selectedTable:r,tablesStatus:c}=P(o=>o.waiter);return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:d.tablesList,children:c&&c.map(o=>{const s=o.status==="ready"?d.ready:o.status==="preparing"?d.preparing:o.status==="delivered"?d.delivered:d.payed;return e.jsx("div",{className:w(d.table,s,r===o.tableNumber?d.selectedTable:""),onClick:()=>{i(p.setSelectedTable(o.tableNumber)),i(p.setSelectedTableProductsToBePaid([]))},children:o.tableNumber},o.tableNumber)})}),e.jsx("div",{className:d.filler})]})},M="_container_14gz6_1",U={container:M},J="_product_1a633_1",K="_ready_1a633_27",V="_preparing_1a633_31",X="_delivered_1a633_35",Y="_payed_1a633_39",_={product:J,ready:K,preparing:V,delivered:X,payed:Y},Z=({orderItem:t})=>{const{selectedTable:i,selectedTableProductsToBePaid:r}=k(n=>n.waiter),[c,{isLoading:o}]=F(),s=B(),[m]=N(),y=r.find(n=>n.id===t.id),h=y?y.quantity:0,f=()=>{s(p.addProductToSelectedTableProductsToBePaid(t))},g=()=>{s(p.increaseQuantityForSelectedTableProduct({productId:t.id}))},j=()=>{s(p.decreaseQuantityForSelectedTableProduct({productId:t.id}))},v=new Date(t.orderTime).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),a=t.status==="ready"?_.ready:["cook","barista","barman"].includes(t.status)?_.preparing:t.status==="delivered"?_.delivered:_.payed;return e.jsxs("div",{className:w(_.product,a),children:[e.jsxs("div",{children:[e.jsxs("h2",{children:[t.name," x",t.quantity]}),e.jsxs("p",{children:["Comandat la ",v]}),["cook","barista","barman"].includes(t.status)&&e.jsx("p",{children:"Se prepara..."}),t.status=="delivered"&&e.jsx("p",{children:"Produs livrat"}),t.status=="payed"&&e.jsx("p",{children:"Produs achitat"})]}),t.status==="payed"?e.jsx("div",{}):t.status==="delivered"?e.jsx(C,{text:"Incaseaza",quantity:h,color:"yellow",tall:!0,onClick:f,onIncrement:g,onDecrement:j,disabled:h===t.quantity}):["cook","barista","barman"].includes(t.status)?e.jsx(x,{text:"Livreaza",color:"orange",disabled:!0,tall:!0}):e.jsx(x,{text:"Livreaza",color:"red",tall:!0,onClick:()=>c({orderProductId:t.id,tableNumber:i}).then(()=>m(i)),loading:o})]})},I="http://localhost:8080",T=L(I,{withCredentials:!0,transports:["websocket"]}),ee=(t,i)=>{const r=`waiter-${t}`;T.emit("join-location",r),console.log(`Waiter attempting to join room: ${r}`),T.off("order-ping"),T.on("order-ping",c=>{console.log("Primit order-ping de la socket:",c),i(c.table)})},te="_bottom-bar_3vf0m_1",se="_products-to-be-paid_3vf0m_22",ae="_product-item_3vf0m_31",oe="_total_3vf0m_32",re="_price_3vf0m_41",ne="_bottom-filler_3vf0m_53",l={bottomBar:te,productsToBePaid:se,productItem:ae,total:oe,price:re,bottomFiller:ne},ce=({})=>{const{selectedTableProductsToBePaid:t,selectedTable:i}=k(a=>a.waiter),r=u.useRef(null),[c,o]=u.useState(100),[s,m]=u.useState([]),[y,{isLoading:h}]=$(),[f]=N(),g=B(),j=()=>{y(t.map(a=>({orderProductId:a.id,quantity:a.quantity}))).then(()=>{f(i),g(p.setSelectedTableProductsToBePaid([]))})};u.useEffect(()=>{const a=t.reduce((n,b)=>{const S=n.find(q=>q.productId===b.productId);return S?S.quantity+=b.quantity:n.push({...b}),n},[]);m(a)},[t]);const v=s.reduce((a,n)=>a+n.price*n.quantity,0);return u.useEffect(()=>{const a=()=>{if(r.current){const b=r.current.offsetHeight;o(b)}};a();const n=new ResizeObserver(a);return r.current&&n.observe(r.current),()=>{n.disconnect()}},[s]),e.jsxs(e.Fragment,{children:[e.jsx("div",{className:l.bottomFiller,style:{height:`${c}px`}}),e.jsx("div",{className:l.bottomBar,ref:r,children:s.length!==0?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:l.productsToBePaid,children:[s.map((a,n)=>e.jsxs("p",{className:l.productItem,children:[e.jsxs("span",{children:[a.name," x",a.quantity]})," ",e.jsxs("span",{className:l.price,children:[(a.price*a.quantity).toFixed(2)," lei"]})]},a.productId+n)),e.jsxs("p",{className:l.total,children:[e.jsx("span",{children:"Total:"})," ",e.jsxs("span",{children:[v.toFixed(2)," lei"]})]})]}),e.jsx(x,{text:"Incaseaza",wider:!0,tall:!0,color:"brand",onClick:j,loading:h})]}):e.jsx(x,{text:"Adauga produse",wider:!0,tall:!0,color:"brand"})})]})},ie=({})=>{const{selectedTable:t,orders:i}=P(s=>s.waiter),{id:r}=P(s=>s.location);z();const[c]=N(),o=i.find(s=>s.table===t);return u.useEffect(()=>{r&&ee(r,s=>{c(s)})},[r,c]),e.jsxs("div",{className:U.container,children:[e.jsx(G,{}),o&&o.products&&o.products.map((s,m)=>e.jsx(Z,{orderItem:s},m)),e.jsx(ce,{})]})},be=ie;export{be as component};
