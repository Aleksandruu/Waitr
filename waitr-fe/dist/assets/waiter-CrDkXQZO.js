import{b as $,l as L,j as e,w as q,m as R,n as O,p as D,q as W,s as M,t as G,r as x,v as U,x as J,y as K,z as V}from"./index-DzrIMVFX.js";import{c as A}from"./className-CUjXWMz9.js";import{B as f}from"./Button-DkkFWPV7.js";import{u as H}from"./app.hooks-DD5JABVg.js";import{Q as X}from"./QuantityButton-CQooDu-m.js";const Y="_tables-list_1o9co_1",Z="_table_1o9co_1",ee="_ready_1o9co_32",te="_preparing_1o9co_35",se="_delivered_1o9co_38",oe="_payed_1o9co_41",ae="_selectedTable_1o9co_44",ne="_filler_1o9co_50",v={tablesList:Y,table:Z,ready:ee,preparing:te,delivered:se,payed:oe,selectedTable:ae,filler:ne},re=t=>{const c=$(),{selectedTable:i,tablesStatus:s}=L(a=>a.waiter);return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:v.tablesList,children:s&&s.map(a=>{const u=a.status==="ready"||a.status==="billed"?v.ready:a.status==="preparing"?v.preparing:a.status==="delivered"?v.delivered:v.payed;return e.jsx("div",{className:A(v.table,u,i===a.tableNumber?v.selectedTable:""),onClick:()=>{c(q.setSelectedTable(a.tableNumber)),c(q.setSelectedTableProductsToBePaid([]))},children:a.tableNumber},a.tableNumber)})}),e.jsx("div",{className:v.filler})]})},ce="_container_1rojh_1",ie="_billsSection_1rojh_10",z={container:ce,billsSection:ie},le="_product_1a633_1",de="_ready_1a633_27",ue="_preparing_1a633_31",pe="_delivered_1a633_35",_e="_payed_1a633_39",k={product:le,ready:de,preparing:ue,delivered:pe,payed:_e},me=({orderItem:t})=>{const{selectedTable:c,selectedTableProductsToBePaid:i}=H(j=>j.waiter),[s,{isLoading:a}]=R(),u=$(),[o]=O(),p=i.find(j=>j.id===t.id),_=p?p.quantity:0,h=()=>{u(q.addProductToSelectedTableProductsToBePaid(t))},g=()=>{u(q.increaseQuantityForSelectedTableProduct({productId:t.id}))},S=()=>{u(q.decreaseQuantityForSelectedTableProduct({productId:t.id}))},P=new Date(t.orderTime).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),N=t.status==="ready"||t.status==="billed"?k.ready:["cook","barista","barman"].includes(t.status)?k.preparing:t.status==="delivered"?k.delivered:k.payed;return e.jsxs("div",{className:A(k.product,N),children:[e.jsxs("div",{children:[e.jsxs("h2",{children:[t.name," x",t.quantity]}),e.jsxs("p",{children:["Comandat la ",P]}),["cook","barista","barman"].includes(t.status)&&e.jsx("p",{children:"Se prepara..."}),t.status=="delivered"&&e.jsx("p",{children:"Produs livrat"}),t.status=="billed"&&e.jsx("p",{children:"Pe nota de plata"}),t.status=="payed"&&e.jsx("p",{children:"Produs achitat"})]}),t.status==="payed"?e.jsx("div",{}):t.status==="delivered"?e.jsx(X,{text:"Incaseaza",quantity:_,color:"yellow",tall:!0,onClick:h,onIncrement:g,onDecrement:S,disabled:_===t.quantity}):["cook","barista","barman"].includes(t.status)?e.jsx(f,{text:"Livreaza",color:"orange",disabled:!0,tall:!0}):t.status==="billed"?"":e.jsx(f,{text:"Livreaza",color:"red",tall:!0,onClick:()=>s({orderProductId:t.id,tableNumber:c}).then(()=>o(c)),loading:a})]})},he="_bill_tvomh_1",xe="_billItems_tvomh_27",ye="_billItem_tvomh_27",je="_tips_tvomh_41",be="_total_tvomh_46",ve="_billed_tvomh_51",T={bill:he,billItems:xe,billItem:ye,tips:je,total:be,billed:ve},ge=({bill:t})=>{const{selectedTable:c}=H(_=>_.waiter),[i,{isLoading:s}]=D(),[a]=O(),u=new Date(t.createdAt).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),o=t.totalAmount,p=t.tips>0?t.tips:0;return e.jsxs("div",{className:A(T.bill,T.billed),children:[e.jsxs("div",{children:[e.jsx("h2",{children:"Nota de plata"}),e.jsxs("p",{children:["Creata la ",u]}),e.jsx("div",{className:T.billItems,children:t.items.map((_,h)=>e.jsxs("div",{className:T.billItem,children:[e.jsxs("span",{children:[_.name," x",_.quantity]}),e.jsxs("span",{children:[_.price*_.quantity," RON"]})]},h))}),p>0&&e.jsxs("p",{className:T.tips,children:["Tips: ",p," RON"]}),e.jsxs("p",{className:T.total,children:["Total: ",o," RON"]})]}),e.jsx(f,{text:"Incaseaza",color:"red",tall:!0,onClick:()=>i(t.id).then(()=>a(c)),loading:s})]})},fe="http://localhost:8080",F=W(fe,{withCredentials:!0,transports:["websocket"]}),Pe=(t,c)=>{const i=`waiter-${t}`;F.emit("join-location",i),console.log(`Waiter attempting to join room: ${i}`),F.off("order-ping"),F.on("order-ping",s=>{console.log("Primit order-ping de la socket:",s),c(s.table)})},Ne="_bottom-bar_3vf0m_1",Ce="_products-to-be-paid_3vf0m_22",Te="_product-item_3vf0m_31",Be="_total_3vf0m_32",qe="_price_3vf0m_41",Se="_bottom-filler_3vf0m_53",B={bottomBar:Ne,productsToBePaid:Ce,productItem:Te,total:Be,price:qe,bottomFiller:Se},we="_popupOverlay_jvep7_1",ke="_popupContent_jvep7_14",Oe="_popupHeader_jvep7_25",Ie="_closeButton_jvep7_37",Fe="_categoriesContainer_jvep7_48",Le="_categoryAccordion_jvep7_54",$e="_categoryHeader_jvep7_60",Ae="_expandIcon_jvep7_73",He="_productsContainer_jvep7_77",Qe="_productItem_jvep7_81",ze="_productInfo_jvep7_92",Ee="_productPrice_jvep7_100",Re="_quantityControls_jvep7_106",De="_quantityButton_jvep7_112",We="_quantity_jvep7_106",Me="_popupFooter_jvep7_135",Ge="_orderSummary_jvep7_145",d={popupOverlay:we,popupContent:ke,popupHeader:Oe,closeButton:Ie,categoriesContainer:Fe,categoryAccordion:Le,categoryHeader:$e,expandIcon:Ae,productsContainer:He,productItem:Qe,productInfo:ze,productPrice:Ee,quantityControls:Re,quantityButton:De,quantity:We,popupFooter:Me,orderSummary:Ge},Ue=({isOpen:t,onClose:c,tableNumber:i})=>{const{data:s,isLoading:a}=M(),[u,{isLoading:o}]=G(),[p,_]=x.useState(null),[h,g]=x.useState([]);x.useEffect(()=>{t&&g([])},[t]),x.useEffect(()=>{s&&s.length>0&&!p&&_(s[0].categoryId)},[s,p]);const S=r=>{_(p===r?null:r)},P=(r,l)=>{g(b=>{const C=b.findIndex(y=>y.id===r);if(C>=0){const y=[...b],n=y[C].quantity+l;return n<=0?y.filter(m=>m.id!==r):(y[C]={...y[C],quantity:n},y)}else if(l>0)return[...b,{id:r,quantity:l}];return b})},N=r=>{const l=h.find(b=>b.id===r);return l?l.quantity:0},j=async()=>{if(!(h.length===0||!i))try{await u({table:i,products:h}).unwrap(),c()}catch(r){console.error("Failed to create order:",r)}},I=h.reduce((r,l)=>r+l.quantity,0);return t?e.jsx("div",{className:d.popupOverlay,children:e.jsxs("div",{className:d.popupContent,children:[e.jsxs("div",{className:d.popupHeader,children:[e.jsxs("h2",{children:["Adaugă produse la masa ",i]}),e.jsx("button",{className:d.closeButton,onClick:c,children:"×"})]}),e.jsx("div",{className:d.categoriesContainer,children:a?e.jsx("p",{children:"Se încarcă produsele..."}):s&&s.length>0?s.map(r=>e.jsxs("div",{className:d.categoryAccordion,children:[e.jsxs("div",{className:d.categoryHeader,onClick:()=>S(r.categoryId),children:[e.jsx("h3",{children:r.categoryName}),e.jsx("span",{className:d.expandIcon,children:p===r.categoryId?"▼":"►"})]}),p===r.categoryId&&e.jsx("div",{className:d.productsContainer,children:r.products.map(l=>e.jsxs("div",{className:d.productItem,children:[e.jsxs("div",{className:d.productInfo,children:[e.jsx("h4",{children:l.name}),e.jsxs("p",{className:d.productPrice,children:[l.price.toFixed(2)," lei"]})]}),e.jsxs("div",{className:d.quantityControls,children:[e.jsx("button",{className:d.quantityButton,onClick:()=>P(l.id,-1),disabled:N(l.id)===0,children:"-"}),e.jsx("span",{className:d.quantity,children:N(l.id)}),e.jsx("button",{className:d.quantityButton,onClick:()=>P(l.id,1),children:"+"})]})]},l.id))})]},r.categoryId)):e.jsx("p",{children:"Nu există produse disponibile."})}),e.jsxs("div",{className:d.popupFooter,children:[e.jsx("div",{className:d.orderSummary,children:e.jsxs("span",{children:["Produse selectate: ",I]})}),e.jsx(f,{text:"Adaugă produsele la comandă",color:"brand",wider:!0,tall:!0,onClick:j,loading:o,disabled:h.length===0})]})]})}):null},Je=({})=>{var y;const{selectedTableProductsToBePaid:t,selectedTable:c,orders:i}=H(n=>n.waiter),s=x.useRef(null),[a,u]=x.useState(100),[o,p]=x.useState([]),[_,{isLoading:h}]=U(),[g]=O(),[S]=J(),P=$(),[N,j]=x.useState(!1),I=!!((y=i.find(n=>n.table===c))!=null&&y.waiterCalledAt),r=()=>{_(t.map(n=>({orderProductId:n.id,quantity:n.quantity}))).then(()=>{g(c),P(q.setSelectedTableProductsToBePaid([]))})},l=()=>{j(!0)},b=()=>{j(!1),g(c)};x.useEffect(()=>{const n=t.reduce((m,w)=>{const Q=m.find(E=>E.productId===w.productId);return Q?Q.quantity+=w.quantity:m.push({...w}),m},[]);p(n)},[t]);const C=o.reduce((n,m)=>n+m.price*m.quantity,0);return x.useEffect(()=>{const n=()=>{if(s.current){const w=s.current.offsetHeight;u(w)}};n();const m=new ResizeObserver(n);return s.current&&m.observe(s.current),()=>{m.disconnect()}},[o]),e.jsxs(e.Fragment,{children:[e.jsx("div",{className:B.bottomFiller,style:{height:`${a}px`}}),e.jsx("div",{className:B.bottomBar,ref:s,children:o.length!==0?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:B.productsToBePaid,children:[o.map((n,m)=>e.jsxs("p",{className:B.productItem,children:[e.jsxs("span",{children:[n.name," x",n.quantity]})," ",e.jsxs("span",{className:B.price,children:[(n.price*n.quantity).toFixed(2)," lei"]})]},n.productId+m)),e.jsxs("p",{className:B.total,children:[e.jsx("span",{children:"Total:"})," ",e.jsxs("span",{children:[C.toFixed(2)," lei"]})]})]}),e.jsx(f,{text:"Creaza nota",wider:!0,tall:!0,color:"brand",onClick:r,loading:h})]}):I?e.jsx(f,{text:"Mergi la masa",wider:!0,tall:!0,color:"red",onClick:()=>S(c).unwrap()}):e.jsx(f,{text:"Adauga produse",wider:!0,tall:!0,color:"brand",onClick:l})}),e.jsx(Ue,{isOpen:N,onClose:b,tableNumber:c})]})},Ke=({})=>{const{selectedTable:t,orders:c}=L(o=>o.waiter),{id:i}=L(o=>o.location);K();const[s]=O(),{data:a}=V(t,{skip:!t}),u=c.find(o=>o.table===t);return x.useEffect(()=>{i&&Pe(i,o=>{s(o)})},[i,s]),e.jsxs("div",{className:z.container,children:[e.jsx(re,{}),a&&a.length>0&&e.jsx("div",{className:z.billsSection,children:a.map(o=>e.jsx(ge,{bill:o},o.id))}),u&&u.products.length>0?u.products.map((o,p)=>e.jsx(me,{orderItem:o},p)):e.jsx("p",{children:"Nu exista comenzi pentru acest masa"}),e.jsx(Je,{})]})},tt=Ke;export{tt as component};
